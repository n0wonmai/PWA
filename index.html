<!DOCTYPE html>
<html lang = "en">
    <head>
        <title>iOS WebPush Testing App</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel= "shortcut icon" href= "./resources/favicon.png">
        <link rel="stylesheet" href="./resources/styles.css" />
        <meta property="og:site_name" content="WebPush App" />

        <link rel="mask-icon" sizes="any" href="https://igor-egorov.dev.altkraft.com/695361968/1/642d6041c5255c487c271100/Favicon.png" color="#FFF">
        <link rel="apple-touch-icon" sizes="192x192" href="https://igor-egorov.dev.altkraft.com/695361968/1/642d6041c5255c487c271100/Favicon.png" />
        <link rel="apple-touch-startup-image" href="https://igor-egorov.dev.altkraft.com/695361968/1/642d6041c5255c487c271100/Favicon.png">

        <meta name="apple-mobile-web-app-title" content="WebPush App">
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="white" />

        <script src="https://pxl.igor-egorov.dev.altkraft.com/ak_container.js?id=MXw2NQ.." ></script>
        <!-- <script src="https://pxl.igor-egorov.dev.altkraft.com/ak_container.js?id=MXw2OQ.." ></script> -->

        <!-- Firebase includes
        <script src="https://www.gstatic.com/firebasejs/5.2.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.2.0/firebase-messaging.js"></script>
        <script type="text/javascript" src="ak-push.js"></script>
        -->
        <link rel="manifest" href="manifest.json"></link>
    </head>
    <body>

        <div class = "container">
            <p>iOS <i class = "apple__icon"></i> Web Push Application</p>
            <p class = "subtitle">Click subscribe to receive notifications</p>   
        </div>

        <div class = "container" style = "margin-top: 10%;">
            <div class = "container__toolbox">
              <button type="button" id="init_sub" style = "margin-top: 10%;">Subscribe profile #1</button>
              <button type="button" id="init_sub_2" style = "margin-top: 10%;">Subscribe profile #2</button>
              <button type="button" id="reset" style = "margin-top: 10%;">Reset token</button>
              <button type="button" id="killer" style = "margin-top: 10%;">Kill workers</button>
            </div>
            <p id ="txt" class="text">Hi üòú</p>
        </div>

<script>
  
  // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ–∫–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è AKPush
  window.onload = function() {

    // –û–±—ä–µ–∫—Ç AKPush
    window.akPush = new AKPush();
    console.log(akPush);

  };

  function setText(id, text) {
    var element = document.getElementById(id);
    element.innerText = text;
  }

  /* –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è 1 */
  document.getElementById('init_sub').addEventListener('click', function() {
    try {
      var email = 'john_doe@somemail.eu';
      akPush.initSubscription({ email: email}); // ..–ø–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –ø–æ–¥–ø–∏—Å–∫–∏
      setText('txt', `–ü—Ä–æ—Ñ–∏–ª—å ${email} –ø–æ–¥–ø–∏—Å–∞–Ω`);
    }

    catch (e) {
      alert(e);
    }

  });

  /* –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è 2 */
  document.getElementById('init_sub_2').addEventListener('click', function() {
    try {
      var email = 'second_profile@mail.ru';
      akPush.initSubscription({ email: email}); // ..–ø–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –ø–æ–¥–ø–∏—Å–∫–∏
      setText('txt', `–ü—Ä–æ—Ñ–∏–ª—å ${email} –ø–æ–¥–ø–∏—Å–∞–Ω`);
    }

    catch (e) {
      alert(e);
    }

  });

  /* –£–¥–∞–ª–∏—Ç—å –≤–æ—Ä–∫–µ—Ä—ã */
  document.getElementById('killer').addEventListener('click', async function() {
    registrations = await navigator.serviceWorker.getRegistrations();
      for(let registration of registrations) {
          registration.unregister();
          setText('txt', `–í–æ—Ä–∫–µ—Ä ${registration.active.scriptURL} —É–¥–∞–ª–µ–Ω`);
      } 
  });

  /* –°–±—Ä–æ—Å–∏—Ç—å —Ç–æ–∫–µ–Ω */
  document.getElementById('reset').addEventListener('click', async function() {
    let akp = AKPush;
    await akp.removeToken();
    setText('txt', `–¢–æ–∫–µ–Ω —É–¥–∞–ª–µ–Ω`);
  });


</script>
<!-- pixel -->
        <script type="text/javascript">
        !function(){var e={url:"https://pxl.igor-egorov.dev.altkraft.com/pixel?k=34FyFph%2BVuzFYrhPh7C10Nk7Jg3MJUl1m%2Fqui6fGQJa6XD9SM9jghQ%3D%3D&s=XZCMwL8NN%2B8%3D",goals:"",value:parseFloat("0"),timeout:parseInt("0"),after_scroll:JSON.parse("false"),auto_load:JSON.parse("true")},o=function(o,t,n,a){var d=[].concat(o).map(function(e){return encodeURIComponent(e)}).join(","),c=encodeURIComponent(String(t||0)),i=encodeURIComponent(n.matching_mode||""),r=encodeURIComponent(n.db_id||0),u=encodeURIComponent(JSON.stringify(n.match||{})),l=encodeURIComponent(JSON.stringify(n.update||{}));setTimeout(function(){(new Image).src=[e.url,"goals="+d,"value="+c,"db_id="+r,"mmode="+i,"match="+u,"update="+l].join("&")},a)},t=!1,n=function(){t||(t=!0,e.after_scroll?document.addEventListener("scroll",function(){(window.pageYOffset||document.documentElement.scrollTop>0)&&o(e.goals,e.value,{},e.timeout)},{once:true}):e.auto_load&&o(e.goals,e.value,{},e.timeout))};"complete"===document.readyState||"interactive"===document.readyState?n():window.addEventListener("load",n);window.ak_pixel_push=function(e,t,n,a,d,c){var i=[];Array.isArray(e)?i=e:i[0]=e,o(i,t,{match:n,update:a,matching_mode:d,db_id:c},0)}}();
        </script>
    </body>
</html>
